# ETL-пайплайн для агрегации пользовательской активности

## Описание проекта

Этот проект представляет собой DAG в Apache Airflow, который ежедневно извлекает, обрабатывает и загружает данные пользовательской активности из симулятора социальной сети в ClickHouse. Скрипт автоматизирует построение витрины данных по измерениям:

- Операционная система (OS)
- Пол (Gender)
- Возраст (Age)

## ETL-процесс

### 1. Извлечение (Extract)

Из ClickHouse выгружаются два набора данных:

- Feed actions (`likes`, `views`, `os`, `gender`, `age`)
- Message actions (`messages_sent`, `users_sent`, `messages_received`, `users_received`)

### 2. Преобразование (Transform)

- Объединение таблиц по `user_id`
- Агрегация метрик по:
  - ОС
  - Полу
  - Возрасту
- Объединение всех агрегатов в финальную таблицу
- Приведение типов и добавление даты события

### 3. Загрузка (Load)

Готовая таблица `final_table` загружается в ClickHouse в таблицу `test.karimov`. При необходимости создаётся структура таблицы.

## Структура финальной таблицы

| Название поля       | Тип         | Описание                              |
|---------------------|-------------|----------------------------------------|
| event_date          | DateTime    | Дата события                          |
| dimension           | String      | Измерение: os, gender, age            |
| dimension_value     | String      | Значение измерения                    |
| views               | Float64     | Количество просмотров                 |
| likes               | Float64     | Количество лайков                     |
| messages_sent       | Float64     | Сообщений отправлено                  |
| users_sent          | Float64     | Пользователей, кому отправили         |
| messages_received   | Float64     | Сообщений получено                    |
| users_received      | Float64     | Пользователей, от кого получены       |

## Используемые технологии

- Python 3
- Apache Airflow — автоматизация расписания
- ClickHouse — источник и хранилище данных
- pandahouse — взаимодействие с ClickHouse
- Pandas — трансформация данных

## Планировщик

DAG запускается каждый день в 23:00:

